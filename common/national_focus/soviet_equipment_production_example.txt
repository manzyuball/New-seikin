# SOV_KV_IS_breakthroughのadd_equipment_productionパターンを参考にした
# NF効果でアンロックしたテクノロジーに対応する装備を自動生産開始するコード例

focus_tree = {
    id = soviet_equipment_production_test

    country = {
        factor = 0
        modifier = {
            add = 10
            tag = SOV
        }
    }

    default = no

    initial_show_position = {
        focus = SOV_test_equipment_production
    }

    # テスト用フォーカス：複数技術と装備の自動生産
    focus = {
        id = SOV_test_equipment_production
        icon = GFX_goal_generic_army_doctrines
        x = 0
        y = 0
        cost = 10
        search_filters = { FOCUS_FILTER_ARMY_XP }

        completion_reward = {
            custom_effect_tooltip = SOV_test_equipment_production_tt

            hidden_effect = {
                # 複数の技術をアンロック
                set_technology = {
                    advanced_heavy_tank = 1
                    advanced_heavy_art = 1
                    mechanised_infantry2 = 1
                    tech_engineers4 = 1
                    tech_logistics_company4 = 1
                }

                # 対応装備を自動生産開始（SOV_KV_IS_breakthroughと同じパターン）

                # 重戦車装備
                add_equipment_production = {
                    equipment = {
                        type = heavy_tank_equipment_3
                    }
                    requested_factories = 30
                    progress = 1.0
                    amount = 30
                }

                # 重砲兵装備
                add_equipment_production = {
                    equipment = {
                        type = heavy_artillery_equipment_2
                    }
                    requested_factories = 25
                    progress = 1.0
                    amount = 25
                }

                # 機械化歩兵装備
                add_equipment_production = {
                    equipment = {
                        type = mechanised_infantry_equipment_2
                    }
                    requested_factories = 20
                    progress = 1.0
                    amount = 40
                }

                # 工兵装備
                add_equipment_production = {
                    equipment = {
                        type = engineer_equipment_3
                    }
                    requested_factories = 15
                    progress = 1.0
                    amount = 15
                }

                # 整備隊装備
                add_equipment_production = {
                    equipment = {
                        type = maintenance_company_equipment_3
                    }
                    requested_factories = 12
                    progress = 1.0
                    amount = 12
                }

                # 新編成テンプレート
                division_template = {
                    name = "試験重機甲師団"
                    is_locked = no
                    priority = 1
                    regiments = {
                        heavy_armor = { x = 0 y = 0 }
                        heavy_armor = { x = 1 y = 0 }
                        heavy_sp_artillery_brigade = { x = 0 y = 1 }
                        heavy_sp_artillery_brigade = { x = 1 y = 1 }
                        mechanized = { x = 2 y = 0 }
                        mechanized = { x = 2 y = 1 }
                        mechanized = { x = 3 y = 0 }
                    }
                    support = {
                        engineer = { x = 0 y = 0 }
                        maintenance_company = { x = 0 y = 1 }
                        signal_company = { x = 0 y = 2 }
                        logistics_company = { x = 0 y = 3 }
                    }
                }

                # 初期部隊創設
                capital_scope = {
                    create_unit = {
                        division = "name = \"試験重機甲師団\" division_template = \"試験重機甲師団\" start_experience_factor = 0.4"
                        owner = SOV
                        count = 8
                        allow_spawning_on_enemy_provs = no
                    }
                }
            }
        }
    }

    # 条件分岐方式の実装例
    focus = {
        id = SOV_conditional_equipment_production
        icon = GFX_focus_generic_tank_production
        x = 1
        y = 0
        cost = 15

        prerequisite = { focus = SOV_test_equipment_production }
        search_filters = { FOCUS_FILTER_ARMY_XP }

        completion_reward = {
            custom_effect_tooltip = SOV_conditional_equipment_production_tt

            hidden_effect = {
                # 技術をアンロック
                set_technology = {
                    super_heavy_tank = 1
                    rocket_artillery = 1
                }

                # 条件分岐で対応装備を生産（汎用性向上パターン）

                # 超重戦車技術がアンロックされたら対応装備を生産
                if = {
                    limit = { has_tech = super_heavy_tank }
                    add_equipment_production = {
                        equipment = {
                            type = super_heavy_tank_equipment_1
                        }
                        requested_factories = 40
                        progress = 1.0
                        amount = 15
                    }
                }

                # ロケット砲技術がアンロックされたら対応装備を生産
                if = {
                    limit = { has_tech = rocket_artillery }
                    add_equipment_production = {
                        equipment = {
                            type = motorized_rocket_equipment_1
                        }
                        requested_factories = 20
                        progress = 1.0
                        amount = 25
                    }
                }

                # 新編成テンプレート
                division_template = {
                    name = "超重戦車師団"
                    is_locked = no
                    priority = 1
                    regiments = {
                        super_heavy_armor = { x = 0 y = 0 }
                        super_heavy_armor = { x = 1 y = 0 }
                        motorized_rocket_artillery_brigade = { x = 0 y = 1 }
                        motorized_rocket_artillery_brigade = { x = 1 y = 1 }
                        mechanized = { x = 2 y = 0 }
                        mechanized = { x = 2 y = 1 }
                    }
                    support = {
                        engineer = { x = 0 y = 0 }
                        maintenance_company = { x = 0 y = 1 }
                    }
                }

                # 初期部隊創設
                capital_scope = {
                    create_unit = {
                        division = "name = \"超重戦車師団\" division_template = \"超重戦車師団\" start_experience_factor = 0.4"
                        owner = SOV
                        count = 4
                        allow_spawning_on_enemy_provs = no
                    }
                }
            }
        }
    }

    # 航空装備自動生産の実装例
    focus = {
        id = SOV_air_equipment_production
        icon = GFX_focus_SOV_flying_clubs
        x = 0
        y = 1
        cost = 15

        prerequisite = { focus = SOV_test_equipment_production }
        search_filters = { FOCUS_FILTER_AIR_XP }

        completion_reward = {
            custom_effect_tooltip = SOV_air_equipment_production_tt

            hidden_effect = {
                # 航空技術をアンロック
                set_technology = {
                    jet_fighter2 = 1
                    jet_CAS = 1
                    advanced_bomber = 1
                }

                # 対応航空装備を自動生産開始

                # ジェット戦闘機
                add_equipment_production = {
                    equipment = {
                        type = jet_fighter_equipment_2
                    }
                    requested_factories = 25
                    progress = 1.0
                    amount = 250
                }

                # ジェット攻撃機
                add_equipment_production = {
                    equipment = {
                        type = jet_CAS_equipment_1
                    }
                    requested_factories = 20
                    progress = 1.0
                    amount = 200
                }

                # 重型爆撃機
                add_equipment_production = {
                    equipment = {
                        type = heavy_bomber_equipment_2
                    }
                    requested_factories = 15
                    progress = 1.0
                    amount = 150
                }

                # 新航空師創設
                capital_scope = {
                    create_wing = {
                        owner = SOV
                        size = 250
                        archetype = jet_fighter
                    }
                    create_wing = {
                        owner = SOV
                        size = 200
                        archetype = jet_CAS
                    }
                    create_wing = {
                        owner = SOV
                        size = 150
                        archetype = heavy_bomber
                    }
                }
            }
        }
    }

    # 海軍装備自動生産の実装例（イタリア向け）
    focus = {
        id = ITA_navy_equipment_production
        icon = GFX_goal_generic_navy
        x = -1
        y = 0
        cost = 20

        # このフォーカスはイタリア用の例として作成
        available = {
            tag = ITA
        }

        completion_reward = {
            custom_effect_tooltip = ITA_navy_equipment_production_tt

            hidden_effect = {
                # 海軍技術をアンロック
                set_technology = {
                    improved_ship_hull_heavy_cruiser = 1
                    early_ship_hull_battleship = 1
                    improved_ship_hull_battleship = 1
                }

                # 対応艦艇装備を自動生産開始

                # 改良重巡洋艦
                add_equipment_production = {
                    equipment = {
                        type = ship_hull_heavy_cruiser_3
                    }
                    requested_factories = 35
                    progress = 1.0
                    amount = 8
                }

                # 早期戦艦
                add_equipment_production = {
                    equipment = {
                        type = ship_hull_battleship_1
                    }
                    requested_factories = 50
                    progress = 1.0
                    amount = 6
                }

                # 改良戦艦
                add_equipment_production = {
                    equipment = {
                        type = ship_hull_battleship_2
                    }
                    requested_factories = 60
                    progress = 1.0
                    amount = 4
                }

                # 新艦隊創設
                capital_scope = {
                    create_unit = {
                        name = "第1艦隊"
                        type = "navy"
                        equipment = {
                            ship_hull_battleship_2 = 4
                            ship_hull_heavy_cruiser_3 = 8
                        }
                        owner = ITA
                    }
                }
            }
        }
    }
}